"use strict";var constrainValue=function(t){var e=t.target,r=parseInt(e.value,10),n=parseInt(e.min,10),a=parseInt(e.max,10);""===r||n>r?r=n:r>a&&(r=a),e.value=r},displayError=function(t){var e=$('<li class="error">\n      <span class="error-timestamp">'+(new Date).toLocaleString()+':</span>\n      <span class="error-message">'+t+'</span>\n      <button type="button" class="error-dismiss">â¨‰</span>\n    </li>');e.on("click",dismissError),e.hide(),$("#errors").append(e),e.fadeIn()},dismissError=function(t){var e=$(t.target).parent(".error");$(t.target).parent(".error").fadeOut(400,function(){e.remove()})},API=function(){var t="http://lightwall.carnegielibrary.org/",e=function(t,e){return axios.get(t)},r=function(t,e){return axios.post(t,e)},n=function(){return new Promise(function(t,e){var r=["running","paused","offline"],n=["wave","ambience"],a=["22fps","26fps","30fps"];t({data:{status:r[Math.floor(3*Math.random())],scene:n[Math.floor(2*Math.random())],frame_rate:a[Math.floor(3*Math.random())]},status:200,statusText:"OK",header:{},config:{}})})},a=function(){return new Promise(function(t,e){t({data:{},status:500,statusText:"OK",header:{},config:{}})})},s=function(){return new Promise(function(t,e){t({data:{},status:200,statusText:"OK",header:{},config:{}})})},o=function(t,e){var r=new Date(Date.now()+36e5*t+6e4*e);return new Promise(function(t,e){t({data:{resume_at:r.toLocaleString()},status:200,statusText:"OK",header:{},config:{}})})};return{rootUrl:t,get:e,post:r,requestStatus:n,requestPowerOn:a,requestPowerOff:s,requestPause:o}}(),Power=function(){var t=function(t,e){return function(r){API.requestPowerOn().then(function(r){200===r.status?t&&t(r):e&&e(r)})["catch"](function(t){displayError("Unable to reach Light Wall server.")})}},e=function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],e=arguments[1],r=arguments[2];return function(n){(t||confirm("Are you sure you want to shut down the light wall?"))&&API.requestPowerOff().then(function(t){200===t.status?e&&e(t):r&&r(t)})["catch"](function(t){displayError("Unable to reach Light Wall server.")})}},r=function(){return e(!0,function(e){t(function(t){refreshStatus()},function(t){displayError("There was a problem turning the Light Wall on.")})()},function(t){displayError("There was a problem turning the Light Wall off.")})};return{on:t,off:e,restart:r}}();$("#power-on").on("click",Power.on(function(t){refreshStatus()},function(t){displayError("There was a problem turning the Light Wall on.")})),$("#power-off").on("click",Power.off(!1,function(t){refreshStatus()},function(t){displayError("There was a problem turning the Light Wall off.")})),$("#power-restart").on("click",Power.restart());var refreshStatus=function(t){var e=$("#loading");e.fadeIn(400,function(){window.setTimeout(function(){API.requestStatus().then(function(t){200===t.status?($("#status").removeClass().addClass("status-"+t.data.status).html(t.data.status),$("#scene").html(t.data.scene),$("#frame-rate").html(t.data.frame_rate),t.data.resume_at&&refreshResumeAt(t.data.resume_at)):($("#status").removeClass().html("unkown"),$("#scene").html("unknown"),$("#frame-rate").html("unkown"),displayError("There was a problem resolving the current status of Light Wall.")),e.fadeOut(400)})["catch"](function(t){$("#status").removeClass().html("unkown"),$("#scene").html("unknown"),$("#frame-rate").html("unkown"),displayError("Unable to reach Light Wall server."),e.fadeOut(400)})},2e3)})},refreshResumeAt=function(t){$("#resume-at-time").html(t),$("#resume-at").show(400)},pauseAmbientAnimation=function(t){var e=$("#pause-hours").val(),r=$("#pause-minutes").val();API.requestPause(e,r).then(function(t){200===t.status?(refreshStatus(),refreshResumeAt(t.data.resume_at)):displayError('Your "pause" request was unable to be processed by the Light Wall server.')})["catch"](function(t){displayError("Unable to reach Light Wall server.")})};$("#admin input[type=number]").on("change",constrainValue),$("#refresh-status").on("click",refreshStatus),$("#pause").on("click",pauseAmbientAnimation),refreshStatus();